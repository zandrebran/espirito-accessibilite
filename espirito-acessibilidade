#!/bin/bash
#
# espirito-acessibilidade 
# Copyright 2013 Zandre Bran (abrandao@students.ic.unicamp.br)
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License 
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>

#yum -y install lynx links elinks xpdf screen xclip clpbar mutt wget mc newsbeuter sylpheed mplayer emacs epiphany

if [ -z "${LANG}" ] 
then
exit 1
fi

EA_MINIMI="espirito-acessibilidade"
EA_DIR="${HOME}${EA_MINIMI}/"
EA_LANG="${EA_DIR}lang_$( echo $LANG | awk -F . {' print $1 '} | tr [A-Z] [a-z] )"
EA_OS="$( lsb_release -is | tr [A-Z] [a-z] )"

if [ ${EA_OS}!="ubuntu" and ${EA_OS}!="fedora" ]
then
exit 1
fi

EA_OS="${EA_DIR}dist_${EA_OS}"

if [ $(echo $PATH | grep $EA_MINIMI | wc -l) -eq 0 ]
then
echo """
EA_DIR=${EA_DIR}
export EA_DIR
EA_LANG=${EA_DIR}${EA_LANG}
export EA_LANG
EA_OS=${EA_OS}
export EA_OS
PATH=${PATH}:${EA_DIR}
export PATH""" >> ${HOME}.bash_profile
. ${HOME}.bash_profile
fi

mkdir ${EA_DIR} || exit 1
cp ${HOME}${EA_MINIMI}-master/* ${EA_DIR} || exit 1
rm -rf ${HOME}${EA_MINIMI}-master 
chmod -R 755 ${EA_DIR} || exit 1

# LANGUAGE - varaibles
#====================================================================
source "${EA_DIR}lang_$( echo ${LANG} | awk -F . {' print $1 '} | tr [A-Z] [a-z] )"
if [ $? -ne 0 ]
then
# language default
#/bin/bash ${EA_DIR}lang_pt_br
exit 1
fi

# DCONF BACKUP - only first time
#====================================================================
ls ${EA_DIR}gsettings_backup &>/dev/null || dconf dump / > ${EA_DIR}gsettings_backup
# recovery backup
# dconf load / < ${EA_DIR}settings_backup

# SETTINGS
#====================================================================
/bin/bash "${EA_DIR}settings" || exit 1
wait

# KEYBINDS
#====================================================================
/bin/bash "${EA_DIR}keybinds --install" || exit 1
wait

# END
#====================================================================
spd-say "$EA_INSTALLOK" || exit 1

